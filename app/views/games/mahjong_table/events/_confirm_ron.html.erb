<% kakan = defined?(@kakan) ? true : false %>

<% if @ron_eligible_players_ids.include?(@game.user_player.id) %>
  <div class="absolute bottom-1/8 right-1/10">
    <div class="flex gap-2" aria-label="ロンの選択肢">
      <%= button_to "ロン",
                    game_play_command_path(@game),
                    params: {
                      event: "confirm_ron",
                      discarded_tile_id: @discarded_tile_id,
                      ron_player_ids: @ron_eligible_players_ids,
                      kakan: kakan
                    },
                    form: { data: { testid: "ron" } },
                    class: "rounded border px-2 py-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-300" %>

      <%= button_to "スルー",
                    game_play_command_path(@game),
                    params: {
                      event: "confirm_ron",
                      discarded_tile_id: @discarded_tile_id,
                      ron_player_ids: (@ron_eligible_players_ids - [ @game.user_player.id ]).presence || [ "" ],
                      kakan: kakan
                    },
                    form: { data: { testid: "through" } },
                    class: "rounded border px-2 py-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-300" %>
    </div>
  </div>
<% else %>
  <%= form_with url: game_play_command_path(@game),
                data: { controller: "auto-submit" } do |form| %>
    <%= form.hidden_field :event, value: "confirm_ron" %>
    <%= form.hidden_field :discarded_tile_id, value: @discarded_tile_id %>
    <% @ron_eligible_players_ids.each do |player_id| %>
      <%= form.hidden_field :ron_player_ids, value: player_id, multiple: true %>
    <% end %>
    <%= form.hidden_field :kakan, value: kakan %>
  <% end %>
<% end %>
